<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart Contract Interface - SC230504503</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.6.0/dist/ethers.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f7f7f7; padding: 20px; }
    h2 { color: #222; }
    button { margin: 5px; padding: 10px 18px; background-color: #007bff; border: none; color: white; border-radius: 5px; cursor: pointer; }
    button:hover { background-color: #0056b3; }
    input { padding: 8px; margin: 5px; width: 260px; border: 1px solid #ccc; border-radius: 5px; }
    p { font-size: 16px; }
  </style>
</head>
<body>
  <h2>Smart Contract DApp - SC230504503</h2>

  <button id="connectButton">Connect MetaMask</button>
  <p id="walletAddress"></p>

  <h3>Current Message:</h3>
  <p id="message">---</p>
  <input type="text" id="newMessage" placeholder="Enter a new message">
  <button id="updateMessage">Update Message</button>

  <h3>Counter:</h3>
  <p id="counter">0</p>
  <button id="increment">Increment Counter</button>
  <button id="reset">Reset Counter (Owner Only)</button>

  <script>
    // ✅ Your deployed contract address on Sepolia
    const CONTRACT_ADDRESS = "0x1Bf376fA18f68116e0f8b9D87CFe2e77f0689f7D";

    // ✅ Contract ABI copied from Remix
    const ABI =
    [
	{
		"inputs": [],
		"name": "incrementCounter",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "resetCounter",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_initMessage",
				"type": "string"
			}
		],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_newMessage",
				"type": "string"
			}
		],
		"name": "updateMessage",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "counter",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getDetails",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "message",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
    ];

    let provider, signer, contract;

    // Connect MetaMask
    document.getElementById("connectButton").onclick = async () => {
      if (!window.ethereum) {
        alert("Please install MetaMask first!");
        return;
      }
      await window.ethereum.request({ method: "eth_requestAccounts" });
      provider = new ethers.BrowserProvider(window.ethereum);
      signer = await provider.getSigner();
      const address = await signer.getAddress();
      document.getElementById("walletAddress").innerText = "Connected wallet: " + address;

      contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
      loadData();
    };

    // Load data
    async function loadData() {
      try {
        const msg = await contract.message();
        const cnt = await contract.counter();
        document.getElementById("message").innerText = msg;
        document.getElementById("counter").innerText = cnt;
      } catch (err) {
        console.error(err);
        alert("Error loading data from contract!");
      }
    }

    // Update message (only owner)
    document.getElementById("updateMessage").onclick = async () => {
      const newMsg = document.getElementById("newMessage").value;
      try {
        const tx = await contract.updateMessage(newMsg);
        await tx.wait();
        alert("Message updated successfully!");
        loadData();
      } catch (err) {
        alert("Failed to update message (check owner permission).");
      }
    };

    // Increment counter
    document.getElementById("increment").onclick = async () => {
      try {
        const tx = await contract.incrementCounter();
        await tx.wait();
        loadData();
      } catch (err) {
        alert("Error incrementing counter.");
      }
    };

    // Reset counter (only owner)
    document.getElementById("reset").onclick = async () => {
      try {
        const tx = await contract.resetCounter();
        await tx.wait();
        alert("Counter reset successfully!");
        loadData();
      } catch (err) {
        alert("Failed to reset counter (only owner can do this).");
      }
    };
  </script>
</body>
</html>
